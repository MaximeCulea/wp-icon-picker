!function(a,b,c){var d,e;d=c.Model.extend({defaults:{type:"",group:"all",icon:""}}),wp.media.model.IconPickerTarget=d,e=c.Collection.extend({initialize:function(a){this.items=new c.Collection(a),this.props=new c.Model({group:"all",search:""}),this.props.on("change",this.refresh,this)},refresh:function(a){var c=this,d=this.items.toJSON();b.each(a.toJSON(),function(a,e){c.filters[e]&&(d=b.filter(d,b.bind(c.filters[e],this),a))},this),this.reset(d)},filters:{group:function(a){var b=this.props.get("group");return"all"===b||a.group===b||""===a.group},search:function(a){var c,d=this.props.get("search");return c=""===d?!0:b.any(["id","name"],function(b){var c=a[b];return c&&-1!==c.search(this)},d)}}}),wp.media.model.IconPickerFonts=e}(jQuery,_,Backbone),function(a,b){var c,d,e,f,g,h=wp.media.View,i=wp.media.view.Attachment.Library,j=wp.media.view.Toolbar,k=wp.media.view.AttachmentFilters,l=wp.media.view.Search,m=wp.media.view.l10n.iconPicker;c=i.extend({className:"attachment icon-picker-item",events:{"click .attachment-preview":"toggleSelectionHandler","click a":"preventDefault"},initialize:function(){this.template=wp.media.template("icon-picker-"+this.options.baseType+"-item"),i.prototype.initialize.apply(this,arguments)},render:function(){var a=b.defaults(this.model.toJSON(),{baseType:this.options.baseType,type:this.options.type});return this.$el.html(this.template(a)),this.updateSelect(),this}}),wp.media.view.IconPickerFontItem=c,d=h.extend({tagName:"ul",className:"attachments icon-picker-items clearfix",initialize:function(){this._viewsByCid={},this.collection.on("reset",this.refresh,this),this.controller.on("open",this.scrollToSelected,this)},render:function(){return this.collection.each(function(a){this.views.add(this.renderItem(a),{at:this.collection.indexOf(a)})},this),this},renderItem:function(a){var b=new c({controller:this.controller,model:a,collection:this.collection,selection:this.options.selection,baseType:this.options.baseType,type:this.options.type});return this._viewsByCid[b.cid]=b},clearItems:function(){b.each(this._viewsByCid,function(a){delete this._viewsByCid[a.cid],a.remove()},this)},refresh:function(){this.clearItems(),this.render()},ready:function(){this.scrollToSelected()},scrollToSelected:function(){var a,b=this.options.selection.single();b&&(a=this.getView(b),a&&!this.isInView(a.$el)&&this.$el.scrollTop(a.$el.offset().top-this.$el.offset().top+this.$el.scrollTop()-parseInt(this.$el.css("paddingTop"),10)))},getView:function(a){return b.findWhere(this._viewsByCid,{model:a})},isInView:function(b){var c=a(window),d=c.scrollTop(),e=d+c.height(),f=b.offset().top,g=f+b.height();return e>=g&&f>=d}}),wp.media.view.IconPickerFontLibrary=d,e=k.extend({createFilters:function(){var a=this.controller.state().get("groups"),b={};b.all={text:m.allFilter,props:{group:"all"}},a.each(function(a){b[a.id]={text:a.get("name"),props:{group:a.id}}}),this.filters=b},change:function(){var a=this.filters[this.el.value];a&&this.model.set("group",a.props.group)}}),wp.media.view.IconPickerFontFilter=e,f=h.extend({className:function(){var a="attachments-browser icon-picker-fonts-browser";return this.options.sidebar||(a+=" no-sidebar"),a},initialize:function(){b.defaults(this.options,{sidebar:!1}),this.groups=this.options.groups,this.createToolbar(),this.createLibrary()},createLibrary:function(){this.items=new d({controller:this.controller,collection:this.collection,selection:this.options.selection,baseType:this.options.baseType,type:this.options.type}),this.views.add(this.items)},createToolbar:function(){this.toolbar=new j({controller:this.controller}),this.views.add(this.toolbar),this.toolbar.set("filters",new e({controller:this.controller,model:this.collection.props,priority:-80}).render()),this.toolbar.set("search",new l({controller:this.controller,model:this.collection.props,priority:60}).render())}}),wp.media.view.IconPickerFontBrowser=f,g=i.extend({template:wp.template("icon-picker-svg-item")}),wp.media.view.IconPickerSvgItem=g}(jQuery,_),function(a,b){var c,d,e=wp.media.controller.State,f=wp.media.controller.Library,g=wp.media.view.l10n,h=wp.media.model,i=wp.media.view;c=e.extend({defaults:{multiple:!1,menu:"default",toolbar:"select",baseType:"font"},initialize:function(){var a=this.get("data");this.set("groups",new Backbone.Collection(a.groups)),this.set("library",new h.IconPickerFonts(a.items)),this.set("selection",new h.Selection(null,{multiple:this.get("multiple")}))},activate:function(){this.frame.on("open",this.refresh,this),this.refresh()},deactivate:function(){this.frame.off("open",this.refresh,this)},refresh:function(){this.resetFilter(),this.updateSelection()},resetFilter:function(){var a=this.get("library"),b=this.get("groups"),c=this.frame.target,d=c.get("group"),e=b.findWhere({id:d});e||(d=c.defaults.group),a.props.set("group",d)},updateSelection:function(){var a,b=this.get("selection"),c=this.get("library"),d=this.frame.target,e=d.get("icon"),f=d.get("type");this.id===f&&(a=c.findWhere({id:e})),b.reset(a?a:null)},getContentView:function(){return new wp.media.view.IconPickerFontBrowser({controller:this.frame,model:this,groups:this.get("groups"),collection:this.get("library"),selection:this.get("selection"),baseType:this.get("baseType"),type:this.get("id")})}}),wp.media.controller.IconPickerFont=c,d=f.extend({defaults:b.defaults({id:"image",syncSelection:!1},f.prototype.defaults),initialize:function(a){var b=this.get("selection");this.options=a,this.set("library",wp.media.query({type:a.data.mimeTypes})),this.routers={upload:{text:g.uploadFilesTitle,priority:20},browse:{text:g.mediaLibraryTitle,priority:40}},b instanceof h.Selection||this.set("selection",new h.Selection(b,{multiple:!1})),f.prototype.initialize.apply(this,arguments)},activate:function(){f.prototype.activate.apply(this,arguments),this.get("library").observe(wp.Uploader.queue),this.frame.on("open",this.updateSelection,this),this.updateSelection()},deactivate:function(){f.prototype.deactivate.apply(this,arguments),this.get("library").unobserve(wp.Uploader.queue),this.frame.off("open",this.updateSelection,this)},getContentView:function(a){var b="upload"===a?this.uploadContent():this.browseContent();return this.frame.$el.removeClass("hide-toolbar"),b},browseContent:function(){return new i.AttachmentsBrowser({controller:this.frame,collection:this.get("library"),selection:this.get("selection"),model:this,sortable:this.get("sortable"),search:this.get("searchable"),filters:this.get("filterable"),sidebar:!1,display:!1,dragInfo:this.get("dragInfo"),idealColumnWidth:this.get("idealColumnWidth"),suggestedWidth:this.get("suggestedWidth"),suggestedHeight:this.get("suggestedHeight"),AttachmentView:"svg"===this.id?i.IconPickerSvgItem:void 0})},uploadContent:function(){return new wp.media.view.UploaderInline({controller:this.frame})},updateSelection:function(){var a,b=this.get("selection"),c=this.frame.target,d=c.get("icon"),e=c.get("type");this.id===e&&(a=h.Attachment.get(d),this.dfd=a.fetch()),b.reset(a?a:null)}}),wp.media.controller.IconPickerImg=d}(jQuery,_),function(a,b){var c,d=wp.media.view.l10n,e=wp.media.view.MediaFrame.Select;c=e.extend({initialize:function(){b.defaults(this.options,{title:d.iconPicker.frameTitle,multiple:!1,ipTypes:iconPicker.types,target:null}),this.options.target instanceof wp.media.model.IconPickerTarget?this.target=this.options.target:this.target=new wp.media.model.IconPickerTarget,e.prototype.initialize.apply(this,arguments)},createStates:function(){var a;b.each(this.options.ipTypes,function(b){wp.media.controller.hasOwnProperty("IconPicker"+b.controller)&&(a=wp.media.controller["IconPicker"+b.controller],this.states.add(new a({id:b.id,content:b.id,title:b.name,data:b.data})))},this)},bindHandlers:function(){this.on("router:create:browse",this.createRouter,this),this.on("router:render:browse",this.browseRouter,this),this.on("content:render",this.ipRenderContent,this),this.on("toolbar:create:select",this.createSelectToolbar,this),this.on("open",this._ipSetState,this),this.on("select",this._ipUpdateTarget,this)},_ipSetState:function(){var a=this.target.get("type");a&&this.states.findWhere({id:a})||(a=this.states.at(0).id),this.setState(a)},_ipUpdateTarget:function(){var a=this.state(),b=this.state().get("selection").single();this.target.set({type:a.id,icon:b.get("id"),group:b.get("group")})},browseRouter:function(a){var b=this.state().routers;b&&a.set(b)},ipRenderContent:function(){var a=this.state(),b=this.content.mode(),c=a.getContentView(b);this.content.set(c)}}),wp.media.view.MediaFrame.IconPicker=c}(jQuery,_);